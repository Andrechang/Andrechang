<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Andre Chang</title>
    <description>Dear blog...</description>
    <link>http://andrechang.github.io/</link>
    <atom:link href="http://andrechang.github.io/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Thu, 04 Aug 2016 22:10:22 -0400</pubDate>
    <lastBuildDate>Thu, 04 Aug 2016 22:10:22 -0400</lastBuildDate>
    <generator>Jekyll v3.2.0</generator>
    
      <item>
        <title>My First Normal Post on Jekyll</title>
        <description>&lt;p&gt;taskset&lt;/p&gt;

</description>
        <pubDate>Sat, 08 Oct 2016 09:26:34 -0400</pubDate>
        <link>http://andrechang.github.io/linux-tricks.html</link>
        <guid isPermaLink="true">http://andrechang.github.io/linux-tricks.html</guid>
        
        <category>html</category>
        
        <category>css</category>
        
        <category>javascript</category>
        
        
        <category>blog</category>
        
        <category>development</category>
        
      </item>
    
      <item>
        <title>MicroZedboard setup</title>
        <description>&lt;h1 id=&quot;intro&quot;&gt;0. Intro&lt;/h1&gt;
&lt;p&gt;To start working on the Zedboard and deploying the FPGA design that you made.&lt;/p&gt;

&lt;h1 id=&quot;prepare-u-boot-linux-kernel-and-device-tree&quot;&gt;1. Prepare U-Boot, Linux Kernel and Device tree.&lt;/h1&gt;
&lt;p&gt;In the boot partition of the SDcard, we need three files:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;uImage  - done in the build kernel section (linux-xlnx/arch/arm/boot/uImage)&lt;/li&gt;
  &lt;li&gt;devicetree.dtb  - done in the build devicetree section (linux-xlnx/arch/arm/boot/dts/zynq-zed.dts)&lt;/li&gt;
  &lt;li&gt;boot.bin  - follow the sections below&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;More information http://www.wiki.xilinx.com/Getting+Started&lt;/p&gt;

&lt;h2 id=&quot;fetch-sources&quot;&gt;Fetch Sources&lt;/h2&gt;

&lt;p&gt;There are two repos that will need to be cloned, one for u-boot and the other
for the linux kernel. Both repos are maintained by Xilinx.&lt;/p&gt;

&lt;p&gt;Make sure to clone the folders u-boot-xlnx and linux-xlnx in the same directory of zynq-axis.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git clone https://github.com/Xilinx/u-boot-xlnx
git clone https://github.com/Xilinx/linux-xlnx
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;setup-environmental-variables&quot;&gt;Setup Environmental Variables&lt;/h2&gt;

&lt;p&gt;Both the u-boot and the kernel will need to be built using the cross compile
tools. These tools should have been installed as part of the Xilinx ISE
package.&lt;/p&gt;

&lt;p&gt;For vivado these tools where installed with SDK. Make sure to have SDK installed.&lt;/p&gt;

&lt;h3 id=&quot;tool-location-variable&quot;&gt;Tool Location Variable&lt;/h3&gt;

&lt;p&gt;On the elab server it is:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;XILINX_EDK&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/export/home/a/workspace/Xilinx/14.4/ISE_DS/EDK
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$XILINX_EDK&lt;/span&gt;/gnu/arm/lin/bin:&lt;span class=&quot;nv&quot;&gt;$PATH&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;On a default linux install:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;XILINX_EDK&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/opt/Xilinx/14.4/ISE_DS/EDK
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$XILINX_EDK&lt;/span&gt;/gnu/arm/lin/bin:&lt;span class=&quot;nv&quot;&gt;$PATH&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Or for Vivado&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;XILINX_SDK&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/opt/Xilinx/SDK/2014.2
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$XILINX_SDK&lt;/span&gt;/gnu/arm/lin/bin:&lt;span class=&quot;nv&quot;&gt;$PATH&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;cross-compile-variables&quot;&gt;Cross Compile Variables&lt;/h3&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CROSS_COMPILE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;arm-xilinx-linux-gnueabi-
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;kernel-build-variables&quot;&gt;Kernel Build Variables&lt;/h3&gt;

&lt;p&gt;Only needed to build the kernel.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ARCH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;arm
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$PWD&lt;/span&gt;/u-boot-xlnx/tools:&lt;span class=&quot;nv&quot;&gt;$PATH&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;dependencies&quot;&gt;Dependencies&lt;/h2&gt;
&lt;p&gt;There may be some dependencies and packages that need to be installed before building the u-boot:&lt;/p&gt;

&lt;p&gt;(http://forums.xilinx.com/t5/Embedded-Linux/Xilinx-Zynq-7000-ZC702-Linux-build-issue/m-p/426328#M8213)&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;gawk&lt;/li&gt;
  &lt;li&gt;build-essential&lt;/li&gt;
  &lt;li&gt;utomake&lt;/li&gt;
  &lt;li&gt;libtool&lt;/li&gt;
  &lt;li&gt;lib32ncurses5&lt;/li&gt;
  &lt;li&gt;lib32ncurses5-dev&lt;/li&gt;
  &lt;li&gt;lib32ncursesw5&lt;/li&gt;
  &lt;li&gt;ncurses-dev:i386&lt;/li&gt;
  &lt;li&gt;libstdc++6:i386&lt;/li&gt;
  &lt;li&gt;libselinux1:i386&lt;/li&gt;
  &lt;li&gt;libgmpxx4ldbl&lt;/li&gt;
  &lt;li&gt;libppl13&lt;/li&gt;
  &lt;li&gt;libppl-c4&lt;/li&gt;
  &lt;li&gt;libcloog-ppl1&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-get install ia32-libs
sudo apt-get install u-boot-tools lzop
sudo apt-get install libssl-dev
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;build-u-boot&quot;&gt;Build u-boot&lt;/h2&gt;

&lt;p&gt;The linux system boots using u-boot from an SD Card root file system.&lt;/p&gt;

&lt;p&gt;Then go to the u-boot-xlnx folder
&lt;code class=&quot;highlighter-rouge&quot;&gt;bash
cd u-boot-xlnx
&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;patch-boot-options&quot;&gt;Patch boot options&lt;/h3&gt;

&lt;p&gt;We don’t want a ramdisk rootfs because the system (OS kernel and applications) is copied from SDcard to a RAM memory during boot. 
And all the work done on the system is saved on a RAM, which means that it will disappear once we turn off the zedboard. 
To avoid this, we want to boot and run the system on SDcard so that we can save our modifications.&lt;/p&gt;

&lt;p&gt;The Xilinx standard u-boot master assumes a ramdisk rootfs. This patch will
ensure the SD card boots from the rootfs on the SD card.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'
diff --git a/include/configs/zynq_common.h b/include/configs/zynq-common.h
--- a/include/configs/zynq-common.h
+++ b/include/configs/zynq-common.h
@@ -241,7 +241,7 @@
        &quot;sdboot=if mmcinfo; then &quot; \
			&quot;run uenvboot; &quot; \
			&quot;echo Copying Linux from SD to RAM... &amp;amp;&amp;amp; &quot; \
			&quot;load mmc 0 ${kernel_load_address} ${kernel_image} &amp;amp;&amp;amp; &quot; \
			&quot;load mmc 0 ${devicetree_load_address} ${devicetree_image} &amp;amp;&amp;amp; &quot; \
-			&quot;load mmc 0 ${ramdisk_load_address} ${ramdisk_image} &amp;amp;&amp;amp; &quot; \
-			&quot;bootm ${kernel_load_address} ${ramdisk_load_address} ${devicetree_load_address}; &quot; \
+			&quot;bootm ${kernel_load_address} - ${devicetree_load_address}; &quot; \
		&quot;fi\0&quot; \
	&quot;usbboot=if usb start; then &quot; \
			&quot;run uenvboot; &quot; \
			&quot;echo Copying Linux from USB to RAM... &amp;amp;&amp;amp; &quot; \
			&quot;load usb 0 ${kernel_load_address} ${kernel_image} &amp;amp;&amp;amp; &quot; \
'&lt;/span&gt; | git apply -
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Get rid of the line that has -&lt;/p&gt;

&lt;p&gt;and add the line that has +&lt;/p&gt;

&lt;h3 id=&quot;building-u-boot-tools&quot;&gt;Building u-boot tools&lt;/h3&gt;
&lt;p&gt;http://www.wiki.xilinx.com/Build+U-Boot&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;make zynq_zc706_config
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;or
&lt;code class=&quot;highlighter-rouge&quot;&gt;bash
make zynq_zed_config
make
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Only needed to build the kernel.
After building the u-boot, the target u-boot elf-file is created in the top level source directory, named ‘u-boot’. 
Additionally in the tools/ directory the ‘mkimage’ utility is created, which is used in other tasks to wrap images into u-boot format.
To make mkimage available in other steps, it is recommended to add the tools directory to your $PATH.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ARCH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;arm
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$PWD&lt;/span&gt;/u-boot-xlnx/tools:&lt;span class=&quot;nv&quot;&gt;$PATH&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;build-linux-kernel&quot;&gt;Build Linux Kernel&lt;/h2&gt;

&lt;p&gt;See http://www.wiki.xilinx.com/Build+kernel&lt;/p&gt;

&lt;p&gt;add a line to /arch/arm/configs/xilinx_zynq_defconfig:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;CONFIG_DMA_CMA&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;y
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Then build kernel with:
&lt;code class=&quot;highlighter-rouge&quot;&gt;bash
make ARCH=arm xilinx_zynq_defconfig
make ARCH=arm menuconfig
make ARCH=arm UIMAGE_LOADADDR=0x8000 uImage
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;In the process, linux-xlnx/arch/arm/boot/Image and linux-xlnx/arch/arm/boot/zImage are created.
The Image file is the uncompressed kernel image and the zImage file is a compressed kernel image which will uncompress itself when it starts.&lt;/p&gt;

&lt;p&gt;If the mkimage utility is available in the build environment, linux-xlnx/arch/arm/boot/uImage will be created by wrapping zImage with a U-Boot header.&lt;/p&gt;

&lt;h3 id=&quot;compiler-version-troubleshooting&quot;&gt;Compiler version Troubleshooting&lt;/h3&gt;
&lt;p&gt;The gcc compiler versions below are not supported:
 * GCC 3.0, 3.1: general bad code generation.
 * GCC 3.2.0: incorrect function argument offset calculation.
 * GCC 3.2.x: miscompiles NEW_AUX_ENT in fs/binfmt_elf.c (http://gcc.gnu.org/PR8896) and incorrect structure initialisation in fs/jffs2/erase.c&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;GCC 4.8.0-4.8.2: https://gcc.gnu.org/bugzilla/show_bug.cgi?id=58854 miscompiles find_get_entry(), and can result in EXT3 and EXT4 filesystem corruption (possibly other FS too).&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Make sure the gcc compiler version is not 4.8.1 or 4.8.2&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;gcc -v
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;If it is then try to change the default gcc to a lower version, by switching the gcc link “/usr/bin/gcc”:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;apt-get install gcc-4.7
sudo rm /usr/bin/gcc
sudo ln -s /usr/bin/gcc-4.7 /usr/bin/gcc
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Make sure the arm-xilinx-linux-gnueabi-gcc version is not 4.8.1 or 4.8.2&lt;/p&gt;

&lt;p&gt;asm-offses.c will output an error (buggy compiler) if arm-xilinx-linux-gnueabi-gcc version is 4.8.1 or 4.8.2&lt;/p&gt;

&lt;p&gt;Check with:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;arm-xilinx-linux-gnueabi-gcc -v
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;build-device-tree&quot;&gt;Build Device Tree&lt;/h2&gt;

&lt;p&gt;Patch the default zedboard device tree source file mount the root file system
from the second partition of the SD card instead of ram.&lt;/p&gt;

&lt;p&gt;Change the file linux-xlnx/arch/arm/boot/dts/zynq-zed.dts&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'
diff --git a/arch/arm/boot/dts/zynq-zed.dts b/arch/arm/boot/dts/zynq-zed.dts
--- a/arch/arm/boot/dts/zynq-zed.dts
+++ b/arch/arm/boot/dts/zynq-zed.dts
@@ -40,7 +40,7 @@
 	memory {
		device_type = &quot;memory&quot;;
		reg = &amp;lt;0x0 0x20000000&amp;gt;;
	};
 	chosen {
-		bootargs = &quot;console=ttyPS0,115200 root=/dev/ram rw earlyprintk&quot;;
+		bootargs = &quot;cma=64M console=ttyPS0,115200 root=/dev/mmcblk0p2 rw earlyprintk rootfstype=ext4 rootwait devtmpfs.mount=0&quot;;
 		linux,stdout-path = &quot;/axi@0/serial@e0001000&quot;;
 	} ;
    };

    &amp;amp;qspi {

'&lt;/span&gt; | git apply -
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Then build the device tree blob.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;make zynq-zed.dtb
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;modifying-devicetree-for-axis&quot;&gt;Modifying Devicetree for AXIS&lt;/h3&gt;

&lt;p&gt;The following AXIS device node needs to be added to the Zynq devicetree to expose the new hardware to the AXIS driver.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;axis: axis@43C00000 &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    compatible &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;xlnx,axis-1.00&quot;&lt;/span&gt;;
    reg &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &amp;lt; 0x43C00000 0x10000 &amp;gt;;
    xlnx,num-mem &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &amp;lt;0x1&amp;gt;;
    xlnx,num-reg &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &amp;lt;0x20&amp;gt;;
    xlnx,s-axi-min-size &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &amp;lt;0x1ff&amp;gt;;
    xlnx,slv-awidth &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &amp;lt;0x20&amp;gt;;
    xlnx,slv-dwidth &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &amp;lt;0x20&amp;gt;;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Source code for a usable and tested devicetree has been placed in the zynq-axis/util directory. 
It is an altered version of the ‘arch/arm/boot/dts/zynq-7000.dtsi’ file found in the linux-xlnx Xilinx repo, 
master branch commit (da2d296bb6b89f7bc7644f6b552b9766ac1c17d5).&lt;/p&gt;

&lt;p&gt;Once the kernel has been compiled for the Zynq, place the altered ‘zynq-7000-dtsi’ file into the kernel ‘arch/arm/boot/dts’ directory. 
Then compile the new devicetree, for the Zedboard run the following command.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;make zynq-zed.dtb
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h1 id=&quot;making-a-bootable-sdcard-with-linaro-linux-for-zynq&quot;&gt;3. Making a Bootable SDcard with Linaro Linux for Zynq&lt;/h1&gt;

&lt;p&gt;We need two partitions on the SDcard: one for boot and one for the Linaro Linux system&lt;/p&gt;

&lt;p&gt;In the boot partition of the SDcard, we need three files:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;uImage  - done in the build kernel section (linux-xlnx/arch/arm/boot/uImage)&lt;/li&gt;
  &lt;li&gt;devicetree.dtb  - done in the build devicetree section (linux-xlnx/arch/arm/boot/dts/zynq-zed.dts)&lt;/li&gt;
  &lt;li&gt;boot.bin  - follow the sections below&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Instructions to setup our custom, headless Linaro system for the Zedboard/Zynq.
Very good source &lt;a href=&quot;http://fpgacpu.wordpress.com/2013/05/24/yet-another-guide-to-running-linaro-ubuntu-desktop-on-xilinx-zynq-on-the-zedboard&quot;&gt;guide&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;partition-sd-card&quot;&gt;Partition SD Card:&lt;/h2&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-get install gparted
sudo gparted
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;2 partitions, 1st is 40 MB, fat32 and Labeled “BOOT”. 2nd partition is 2048 MB,
ext4 and Labeled “rootfs”.&lt;/p&gt;

&lt;p&gt;Once you partitioned the SDcard, check if there are two partitions to be mounted:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo fdisk -l
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;You should see something with “/dev/sdb1” and “/dev/sdb2” in the output&lt;/p&gt;

&lt;p&gt;Mount both partitions:
&lt;code class=&quot;highlighter-rouge&quot;&gt;bash
sudo  mkdir /media/BOOT
sudo  mkdir /media/rootfs
sudo mount /dev/sdb1 /media/BOOT
sudo mount /dev/sdb2 /media/rootfs
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Once you are done making the SDcard, dont forget to un-mount it
&lt;code class=&quot;highlighter-rouge&quot;&gt;bash
sudo umount /media/sdb1
sudo umount /media/sdb2
&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;download-linaro-rootfs&quot;&gt;Download linaro rootfs:&lt;/h2&gt;

&lt;p&gt;http://www.linaro.org/downloads/&lt;/p&gt;

&lt;p&gt;Scroll to the “Developers and Community Builds” section. In the table entry for
“Ubuntu Desktop” click one of the links in the “download” section.&lt;/p&gt;

&lt;p&gt;As of writing this was the latest “desktop” release URL is.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;wget https://releases.linaro.org/archive/12.11/ubuntu/precise-images/ubuntu-desktop/linaro-precise-ubuntu-desktop-20121124-560.tar.gz
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;copy-files-to-sd-card&quot;&gt;Copy files to SD Card&lt;/h2&gt;

&lt;p&gt;After downloading the Linaro, you need to extract the tar.gz into the rootfs partition in the SDcard.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo tar --strip-components&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;3 -C /media/rootfs -xzpf linaro-precise-ubuntu-desktop-20121124-560.tar.gz binary/boot/filesystem.dir
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;After following the section “2. Prepare U-Boot, Linux Kernel and Device tree”, 
you can copy uImage and devicetree file to BOOT partition of the SDcard&lt;/p&gt;

&lt;p&gt;copy uImage from linux-xlnx/arch/arm/boot/uImage to /media/BOOT/&lt;/p&gt;

&lt;p&gt;copy zynq-zed.dtb file from linux-xlnx/arch/arm/boot/dts/ to /media/BOOT/ and rename as “devicetree.dtb”&lt;/p&gt;

&lt;h2 id=&quot;build-fsbl-first-stage-boot-loader&quot;&gt;Build FSBL (First stage boot loader)&lt;/h2&gt;

&lt;p&gt;Look into xilinx document chapter 5 http://forums.xilinx.com/xlnx/attachments/xlnx/ELINUX/8467/1/zedboard_CTT_v2013_2_130807.pdf&lt;/p&gt;

&lt;p&gt;In order to relate the software (Linux) with the hardware PL (programable logic) that you created,
we need to create a FSBL(first state boot loader) application in Xilinx SDK program. 
Thus, we need the hardware from  section “1. Hardware”. 
Remember that the Vivado project is in /zynq-axis-master/syn/scratch/project-zedboard_axis/
But, the generated bitstream file is in /zynq-axis-master/zedboard_axis.bit&lt;/p&gt;

&lt;p&gt;In the Vivado program, after the Bitstream generation completes, 
you need to export the hardware File &amp;gt; Export &amp;gt; Export Hardware
(make sure that you enable the “Include Bitstream” option).&lt;/p&gt;

&lt;p&gt;Then launch SDK.&lt;/p&gt;

&lt;p&gt;In SDK, select File &amp;gt; New &amp;gt; Application Project.
The New Project wizard opens; for Project Name, type in zynq_fsbl_0 and
click Next.&lt;/p&gt;

&lt;p&gt;Select Zynq FSBL in the Template list and keep the remaining default options.
The Location of your project, the hardware platform used, and the processor are
visible in this window.&lt;/p&gt;

&lt;p&gt;Click Finish to generate the FSBL.&lt;/p&gt;

&lt;p&gt;The Zynq FSBL compiles and .ELF file is generated in the folder&lt;/p&gt;

&lt;p&gt;your_project_path / project_name.sdk / zynq_fsbl_0 / Debug /&lt;/p&gt;

&lt;h2 id=&quot;generate-bootbin-file&quot;&gt;Generate BOOT.BIN file&lt;/h2&gt;

&lt;p&gt;To generate the last file need for the SDcard, we need to get copy of:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;system.bit (zedboard_axis.bit - bitfile generated in Vivado),&lt;/li&gt;
  &lt;li&gt;u-boot.elf (in u-boot-xlnx folder. Need to rename u-boot to u-boot.elf) and&lt;/li&gt;
  &lt;li&gt;zynq_fsbl.elf (created using Xilinx SDK).&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Then create a .bif file.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; -n &lt;span class=&quot;s1&quot;&gt;'the_ROM_image:
{
[bootloader]zynq_fsbl.elf
zedboard_axis.bit
u-boot.elf
}
'&lt;/span&gt; &amp;gt; bootconfig.bif

bootgen -image bootconfig.bif -o i boot.bin
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;You can also use the SDK to generate the boot.bin. Refer to xilinx tutorial.&lt;/p&gt;

&lt;p&gt;Don’t forget to copy the boot.bin to /media/BOOT/&lt;/p&gt;

&lt;h2 id=&quot;bootup&quot;&gt;Bootup&lt;/h2&gt;

&lt;p&gt;The above instructions should make a bootable SD Card. Make sure the jumpers
are set correctly on the Zedboard, insert SD Card and power up.&lt;/p&gt;

&lt;p&gt;Jumpers: JP7-GND, JP8-GND, JP9-3V, JP10-3V, JP11-GND&lt;/p&gt;

&lt;p&gt;Connect a USB to the UART port and start up a Serial Terminal (eg. gtkterm) to
view boot messages and get first access to the system.&lt;/p&gt;

&lt;h1 id=&quot;linux-uio-driver&quot;&gt;4. Linux UIO Driver&lt;/h1&gt;

&lt;p&gt;This Linux driver has been developed to run on the Xilinx Zynq ARM. It is a userspace input/output driver (UIO) that enables the passing of register values to and from the Zynq FPGA. Userspace libraries/applications use this UIO driver to configure and control the AXIS modules operation. It also controls a contiguous memory area that is used to pass data between the host (PS) and FPGA (PL) sides of the Zynq.&lt;/p&gt;

&lt;h2 id=&quot;compile-driver&quot;&gt;Compile Driver&lt;/h2&gt;

&lt;p&gt;Kernel modules need to be built against the version of the kernel it will be inserted in. It is recommended to uses the Linux kernel maintained by Xilinx.
https://github.com/Xilinx/linux-xlnx.git&lt;/p&gt;

&lt;p&gt;The driver module can be compiling outside of the Linux kernel source tree. 
A variable ‘KDIR’ in the Makefile is used to point to the kernel source directory. 
The default value has it pointing to the default Linux install location for kernel sources. 
However, if cross compiling or if the sources are in a non-default location the value can be overridden using 
an exported environmental variable or as an argument passes into the make command.
Assuming that folder linux-xlnx and zynq-axis are in the same directory.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;zynq-axis/dev/
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;KDIR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;../../linux-xlnx
make
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;or&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;zynq-axis/dev/
make &lt;span class=&quot;nv&quot;&gt;KDIR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;../../linux-xlnx
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;After compiling the driver, you need to have the zynq-axis files on the zedboard (embedded linux).&lt;/p&gt;

&lt;p&gt;One way to do this is to copy the folder zynq-axis to the rootfs partition of the SDcard.&lt;/p&gt;

&lt;p&gt;The following sections are done in the embedded linux through a serial connection (eg. gtkterm or putty).&lt;/p&gt;

&lt;h2 id=&quot;installing-driver&quot;&gt;Installing Driver&lt;/h2&gt;

&lt;p&gt;Use of the driver module requires it to be inserted into the running Linux kernel. Once inserted it will automatically create a character device file in ‘/dev’ called ‘/dev/uio*’. However, the default permissions will not allow non-root users to read/write to the file, nor is the numbering consistent if more then one UIO driver is being used. These problems are overcome by installing the udev rule file found in this projects util directory into the systems ‘/etc/udev/rules.d/’ directory.
&lt;code class=&quot;highlighter-rouge&quot;&gt;bash
sudo cp util/80-axis.rules /etc/udev/rules.d/
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;To install the module and have it loaded at boot, first install the udev rule as shown above and then follow the below instructions.
&lt;code class=&quot;highlighter-rouge&quot;&gt;bash
sudo mkdir -p /lib/modules/$(uname -r)/extra/
sudo cp axis.ko /lib/modules/$(uname -r)/extra/
sudo depmod -a
&lt;/code&gt;
Need reboot here.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo reboot
sudo modprobe axis
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;If there is error saying that Kernel dont have support axis.ko after sudo modprobe axis&lt;/p&gt;

&lt;p&gt;Then your Kernel or your driver was build wrong. Redo section “2.Build Linux Kernel” and load the newest uImage into SDcard.
Also do section “4. Compile Driver” again and load the newest zynq-axis/dev folder into SDcard&lt;/p&gt;

&lt;h2 id=&quot;library&quot;&gt;Library&lt;/h2&gt;

&lt;p&gt;The axis library has to be built and installed on the Zynq before the example applications can be compiled. The library offers a number of generic functions for use in configuring the axis hardware.
&lt;code class=&quot;highlighter-rouge&quot;&gt;bash
cd zynq-axis/lib/
make
make install
&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;applications&quot;&gt;Applications&lt;/h2&gt;

&lt;p&gt;The example application demonstrates some simple usage of the AXIS system.
&lt;code class=&quot;highlighter-rouge&quot;&gt;bash
cd zynq-axis/app/
make
&lt;/code&gt;
Try it out:
&lt;code class=&quot;highlighter-rouge&quot;&gt;bash
cd zynq-axis/app/
./test-mem /dev/axis
&lt;/code&gt;&lt;/p&gt;

&lt;h1 id=&quot;customize-linaro-system&quot;&gt;5.Customize Linaro System&lt;/h1&gt;

&lt;p&gt;The following have been done to make the &lt;em&gt;elab&lt;/em&gt; system.&lt;/p&gt;

&lt;h2 id=&quot;turn-off-swapping&quot;&gt;Turn off swapping:&lt;/h2&gt;

&lt;p&gt;This reduces the amount of data being written to the SD card and thus make it
less likely to throw an error during heavy use. Since the linaro system is not
being used for any RAM heavy task this is unlikely to cause problems. It also
reduces the likelihood of the system crashing during the running of our demos.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;vm.swappiness = 0&quot;&lt;/span&gt; | sudo tee -a /etc/sysctl.conf
sudo reboot
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;You cat find out what the systems ‘swapiness’ is set to using:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cat /proc/sys/vm/swappiness
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;turn-off-logging&quot;&gt;Turn off logging:&lt;/h2&gt;

&lt;p&gt;Logging on our system can quickly use up all available space on the SD card by
writing to the “/var/log/kern.log” file and “/var/log/syslog” file. The easiest
way to stop that is to turn off system logging:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;manual | sudo tee --append /etc/init/rsyslog.override
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;source (http://askubuntu.com/questions/306237/how-to-disable-the-log-files)&lt;/p&gt;

&lt;h2 id=&quot;use-tmpfs-for-some-system-directories&quot;&gt;Use tmpfs for some system directories&lt;/h2&gt;

&lt;p&gt;When the system writes to any of these system directories they will write to a
ram disk instead of the SD card. This reduces the number and frequency of
writes to the SD card and thus makes the system ans a whole more stable.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; -n &lt;span class=&quot;s1&quot;&gt;'
tmpfs        /var/run       tmpfs    defaults,noatime    0    0
tmpfs        /var/lock      tmpfs    defaults,noatime    0    0
tmpfs        /var/log       tmpfs    defaults,noatime    0    0
tmpfs        /var/run       tmpfs    defaults,noatime    0    0
tmpfs        /var/mail      tmpfs    defaults,noatime    0    0
tmpfs        /var/spool     tmpfs    defaults,noatime    0    0
tmpfs        /var/tmp       tmpfs    defaults,noatime    0    0
tmpfs        /var/cache     tmpfs    defaults,noatime    0    0
'&lt;/span&gt; | sudo tee -a /etc/fstab

&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;ssh-server&quot;&gt;SSH Server:&lt;/h2&gt;

&lt;p&gt;Dropbear&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;apt-get install -y dropbear
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;make it so root cannot ssh in.&lt;/p&gt;

&lt;p&gt;vim /etc/default/dropbear
DROPBEAR_EXTRA_ARGS=”-w”&lt;/p&gt;

&lt;h2 id=&quot;time-on-the-zedboard&quot;&gt;Time on the Zedboard&lt;/h2&gt;

&lt;p&gt;The Zedboard will forget the time on a power cycle, to work around this have
the Zedboard get the time from the network.&lt;/p&gt;

&lt;h3 id=&quot;setting-clock-with-ntp-network-time-protocol&quot;&gt;Setting Clock with NTP (network time protocol):&lt;/h3&gt;

&lt;p&gt;sudo apt-get install -y ntp&lt;/p&gt;

&lt;p&gt;sudo ntpdate horologe.cerias.purdue.edu&lt;/p&gt;

&lt;p&gt;(http://askubuntu.com/questions/244526/unable-to-synchronize-time-using-ntp)&lt;/p&gt;

&lt;p&gt;sudo vim /etc/ntp.conf # add line: “server horologe.cerias.purdue.edu” to file&lt;/p&gt;

&lt;h3 id=&quot;time-zone&quot;&gt;Time Zone:&lt;/h3&gt;

&lt;p&gt;sudo dpkg-reconfigure tzdata&lt;/p&gt;

&lt;p&gt;(http://www.wikihow.com/Change-the-Timezone-in-Linux)&lt;/p&gt;

&lt;h2 id=&quot;ip-monitor-script&quot;&gt;IP Monitor Script&lt;/h2&gt;

&lt;p&gt;A small script will be setup to run at boot that will monitor when a new dhcp
lease has been acquired. A new dhcp lease is always acquired when a new IP
address is assigned to the Zedboard by a dhcp server.&lt;/p&gt;

&lt;p&gt;First, a non-pass-phrase protected ssh key pair needs to be generated so that
the monitor script can communicate with the elab server without requiring a
password. This can be done on a computer that has OpenSSH installed and then by
copying the two key files over to the Zedboard. Once the keys are on the
Zedboard, rename the two key files “rsync_id_rsa” and “rsync_id_rsa.pub”, then
move them to a directory called “$HOME/.ip_addr/”.&lt;/p&gt;

&lt;p&gt;On the server:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ssh-keygen -t rsa -f rsync_id_rsa
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;On the zynq:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mkdir -p &lt;span class=&quot;nv&quot;&gt;$HOME&lt;/span&gt;/.ip_addr
cp rsync_id_rsa&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$HOME&lt;/span&gt;/.ip_addr/
chmod 400 &lt;span class=&quot;nv&quot;&gt;$HOME&lt;/span&gt;/.ip_addr/rsync_id_rsa&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;To enable auto log-in from Zedboard to server, the contents of
“rsync_id_rsa.pub” needs to be added to the “.ssh/authorized_keys” file on the
elab server. For safety it is best to restrict the actions of the ssh key to
just rsync of a single directory. Thus when adding the ssh pub key to the elabs
“.ssh/authorized_keys” file, include the following ‘command’ to the entry:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;command=&quot;rsync --server -vvvlogDtpre.iLsf . ${HOME}/.ip_addr/&quot; ssh-rsa &amp;lt;zedboard ssh-rsa pub key&amp;gt; linaro@zynq
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Remember to replace &lt;zedboard ssh-rsa=&quot;&quot; pub=&quot;&quot; key=&quot;&quot;&gt; with __your__ ssh-rsa public key
from the Zedboard. Then create the monitor program on the Zedboard:&lt;/zedboard&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;apt-get install -y inotify-tools
mkdir &lt;span class=&quot;nv&quot;&gt;$HOME&lt;/span&gt;/.ip_addr
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; -n &lt;span class=&quot;s1&quot;&gt;'
sleep 2
hostname -I &amp;gt; /home/linaro/.ip_addr/ip-addr-$(hostname)

if [ -n &quot;$(cat /home/linaro/.ip_addr/ip-addr-$(hostname) | tr -d &quot; &quot;)&quot; ]
then
	rsync -a -e &quot;ssh -i ${HOME}/.ip_addr/rsync_id_rsa&quot; ${HOME}/.ip_addr/ip-addr-$(hostname) &amp;lt;username&amp;gt;@elab.ecn.purdue.edu:${HOME}/.ip_addr
else
	sleep 60
	hostname -I &amp;gt; /home/linaro/.ip_addr/ip-addr-$(hostname)

	if [ -z &quot;$(cat /home/linaro/.ip_addr/ip-addr-$(hostname) | tr -d &quot; &quot;)&quot; ]
	then
		echo &quot;reboot&quot;
		sudo reboot
	fi
fi


while inotifywait -e modify -e create -e delete -e move -r $1; do
	sleep 2
	hostname -I &amp;gt; /home/linaro/.ip_addr/ip-addr-$(hostname)

	if [ -n &quot;$(cat /home/linaro/.ip_addr/ip-addr-$(hostname) | tr -d &quot; &quot;)&quot; ]
	then
		rsync -a -e &quot;ssh -i ${HOME}/.ip_addr/rsync_id_rsa&quot; ${HOME}/.ip_addr/ip-addr-$(hostname) &amp;lt;username&amp;gt;@elab.ecn.purdue.edu:${HOME}/.ip_addr
	else
		sleep 60
		hostname -I &amp;gt; /home/linaro/.ip_addr/ip-addr-$(hostname)

		if [ -z &quot;$(cat /home/linaro/.ip_addr/ip-addr-$(hostname) | tr -d &quot; &quot;)&quot; ]
		then
			echo &quot;reboot&quot;
			sudo reboot
		fi
	fi
done
'&lt;/span&gt; &amp;gt; &lt;span class=&quot;nv&quot;&gt;$HOME&lt;/span&gt;/.ip_addr/ip-monitor
chmod 744 &lt;span class=&quot;nv&quot;&gt;$HOME&lt;/span&gt;/.ip_addr/ip-monitor
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Edit /etc/rc.local script and add the following before ‘exit 0’:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;su -l linaro -c &lt;span class=&quot;s1&quot;&gt;'/home/linaro/.ip_addr/ip-monitor /var/lib/dhcp &amp;amp;&amp;gt; /dev/null &amp;amp;'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;On elab server add to your “$HOME/.bashrc” file:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;function &lt;/span&gt;linaro&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; 1 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;do
		case&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in
			&lt;/span&gt;p&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; cat &lt;span class=&quot;nv&quot;&gt;$HOME&lt;/span&gt;/.ip_addr/ip-addr-&amp;lt;zync hostname&amp;gt; | tr -d &lt;span class=&quot;s1&quot;&gt;' '&lt;/span&gt;; &lt;span class=&quot;nb&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
			b&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; ssh -o &lt;span class=&quot;nv&quot;&gt;ConnectTimeout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1 -i ~/.ssh/id_rsa_zynq linaro@&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;cat &lt;span class=&quot;nv&quot;&gt;$HOME&lt;/span&gt;/.ip_addr/ip-addr-&amp;lt;zync hostname&amp;gt; | tr -d &lt;span class=&quot;s1&quot;&gt;' '&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;; &lt;span class=&quot;nb&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
			&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; ssh -X -t -q -o &lt;span class=&quot;nv&quot;&gt;UserKnownHostsFile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/dev/null -o &lt;span class=&quot;nv&quot;&gt;StrictHostKeyChecking&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;no -o &lt;span class=&quot;nv&quot;&gt;ConnectTimeout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1 -i ~/.ssh/id_rsa_zynq linaro@&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;cat &lt;span class=&quot;nv&quot;&gt;$HOME&lt;/span&gt;/.ip_addr/ip-addr-&amp;lt;zynq hostname&amp;gt; | tr -d &lt;span class=&quot;s1&quot;&gt;' '&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;tmux attach -d || tmux new&quot;&lt;/span&gt;; sleep 3;;
		&lt;span class=&quot;k&quot;&gt;esac
	done&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;If the Zedboard changes IP addresses while you are logged in, the ssh session
will freeze. The ‘ConnectTimeout’ in the above commands will automatically end
the session after a second. Alternatively, you can add the following line to the
“.ssh/config” file on the elab server.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ServerAliveInterval 1
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The above ‘linaro’ function works best when you have auto login using ssh keys.
If however your default ssh key is password protected you might fine it best to
generate second key for use just with the Zedboard. To use the 2nd key add the
‘-i’ flag to the ssh commands in the ‘linaro’ function, example below.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-i ~/.ssh/id_rsa_zynq
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;rename-system&quot;&gt;Rename System&lt;/h2&gt;

&lt;p&gt;Edit /etc/hostname to be the new hostname&lt;/p&gt;

&lt;p&gt;and edit last line in /etc/hosts&lt;/p&gt;

&lt;p&gt;127.0.1.1       &lt;new hostname=&quot;&quot;&gt;&lt;/new&gt;&lt;/p&gt;

&lt;h2 id=&quot;mount-sd-card-partitions&quot;&gt;Mount SD Card Partitions&lt;/h2&gt;

&lt;p&gt;Add:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;devtmpfs.mount=1
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;to the bootargs in the devicetree. This will get the mmcblk0 device to show up.&lt;/p&gt;

&lt;p&gt;To make it easy to mount a partition (for example the “boot” partition) by a
user (without using sudo), add the following to the “/etc/fstab” file.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/dev/mmcblk0p1  /boot   vfat    defaults,noauto,users   0       0
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;workaround-for-cpufreq-error&quot;&gt;Workaround for cpufreq error&lt;/h2&gt;

&lt;p&gt;Since the zynq is having problems with changing the scaling of the clock
frequency the Linaro system must limit the number of frequencies it can use.
The following workaround should be applied when the error “cpufreq_cpu0: failed to
set clock rate: -16” shows up in the UART or/and when the reported system clock
is slower then the wall clock time.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo update-rc.d ondemand disable
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;The above was taken from the following Xilinx forum discussion.&lt;/p&gt;

&lt;p&gt;http://forums.xilinx.com/t5/Embedded-Linux/System-clock-is-slow/m-p/411993/highlight/true#M7830&lt;/p&gt;

&lt;h2 id=&quot;linux-setup&quot;&gt;Linux setup&lt;/h2&gt;
&lt;p&gt;sudo apt-get install openssh-client openssh-server&lt;/p&gt;

&lt;p&gt;passwd&lt;/p&gt;
</description>
        <pubDate>Wed, 31 Aug 2016 09:26:34 -0400</pubDate>
        <link>http://andrechang.github.io/microzed-setup.html</link>
        <guid isPermaLink="true">http://andrechang.github.io/microzed-setup.html</guid>
        
        <category>FPGA</category>
        
        <category>Zedboard</category>
        
        
        <category>Getting</category>
        
        <category>started</category>
        
      </item>
    
      <item>
        <title>dualboot setup</title>
        <description>&lt;h2 id=&quot;dual-boot&quot;&gt;Dual boot&lt;/h2&gt;
&lt;p&gt;follow:http://www.everydaylinuxuser.com/2015/11/how-to-install-ubuntu-linux-alongside.html&lt;/p&gt;

&lt;p&gt;after install then continue testing ubuntu
and place ubuntu boot as first using efibootmgr. Don’t put windows boot as first.&lt;/p&gt;

&lt;p&gt;then reboot to windows and then shutdown using windows.&lt;/p&gt;

&lt;p&gt;Remove usb-boot. And then turn on and boot on ubuntu.&lt;/p&gt;

&lt;p&gt;Then on the right-top corner go to System Information-&amp;gt;System&amp;amp;Updates-&amp;gt;Additional Drivers
And select the Nvidia driver not the Xorg stuff (Make sure it is connect to internet).&lt;/p&gt;

&lt;p&gt;Then reboot. If it get stuff then press powerbutton to restart.&lt;/p&gt;

&lt;p&gt;Don’t update the nvidia drivers using command line. it breaks the desktop.&lt;/p&gt;

&lt;p&gt;To install CUDA. Download the bin file from: https://developer.nvidia.com/cuda-toolkit
Don’t install the Nvidia drivers using the bin. Say no to drivers since you already have them.
Just install the CUDA toolkit and the samples.&lt;/p&gt;

&lt;p&gt;http://docs.nvidia.com/cuda/cuda-getting-started-guide-for-linux/#mandatory-post&lt;/p&gt;

</description>
        <pubDate>Wed, 31 Aug 2016 09:26:34 -0400</pubDate>
        <link>http://andrechang.github.io/dualboot.html</link>
        <guid isPermaLink="true">http://andrechang.github.io/dualboot.html</guid>
        
        <category>FPGA</category>
        
        <category>Zedboard</category>
        
        
        <category>Getting</category>
        
        <category>started</category>
        
      </item>
    
      <item>
        <title>Aprendendo a aprender</title>
        <description>&lt;p&gt;Esse post eh um tutorial passo-a-passo para aprender e implementar sistemas de
aprendizado de maquina (machine learning).&lt;/p&gt;

&lt;p&gt;Esse documento eh meu diario de pesquisa. Eh para eu relembrar os conceitos quando eu ficar velho.
Gramatica especialmente acentuacao nao eh importante aqui.&lt;/p&gt;

&lt;p&gt;#Capitulo 1 - Preparo
Voce comprou um computador novo potente e com um cartao grafico poderoso da
NVIDIA. Para muitos eh uma maquina para jogar jogos legais. Mas com esse mesmo computador
da para criar modelos de aprendizado de maquina no estado da arte e criar aplicacoes
inovadoras e ganhar muito dinheiro, para depois mais jogo (eh claro).&lt;/p&gt;

&lt;p&gt;Para criar maquina inteligente precisaremos de Ubuntu, pois muitas ferramentas que iremos usar
so suporta sistemas operacionais baseado em Unix: familia Linux e os MAC. Eu tenho um PC com
windows. Assim preciso criar um dualboot com Ubuntu. Nao vo usar maquina virtual pois para usar o cartao
grafico eh mais facil pelo dualboot do que usar maquina virtual, pois eh uma dor de cabeca para
virtualizar as portas PCI-e que sao usados pela cartao grafico. Para dualboot siga as instrucoes diponiveis aqui:
http://www.everydaylinuxuser.com/2015/11/how-to-install-ubuntu-linux-alongside.html&lt;/p&gt;

&lt;p&gt;Tendo Ubuntu rodando, iremos precisar instalar varias coisas.
Lista de coisas importantes para instalar em um novo linux&lt;/p&gt;

&lt;p&gt;Iremos usar a ferramenta torch7. Torch7 eh uma biblioteca de modulos de aprendizado
de maquina open-source desenvolvida pela comunidade. O mais legal eh que torch7 usa
como Lua como linguagem base de programacao. Lua foi criado no Rio de Janeiro (viva Brasil).
Lua eh parecido com matlab, javascript ou python, ou seja nao eh dificil de aprender.
http://tylerneylon.com/a/learn-lua/&lt;/p&gt;

&lt;p&gt;#Capitulo 2 - Mao na massa&lt;/p&gt;

&lt;p&gt;#Capitulo 3 - FPGA?&lt;/p&gt;

&lt;p&gt;#Capitulo 4 - Papeis para ler&lt;/p&gt;

</description>
        <pubDate>Thu, 04 Aug 2016 09:26:34 -0400</pubDate>
        <link>http://andrechang.github.io/Aprendendo-a-aprender.html</link>
        <guid isPermaLink="true">http://andrechang.github.io/Aprendendo-a-aprender.html</guid>
        
        <category>Torch7</category>
        
        <category>Eletronica</category>
        
        <category>Computacao</category>
        
        
        <category>aprendizado</category>
        
        <category>de</category>
        
        <category>maquina</category>
        
      </item>
    
      <item>
        <title>Good to know in Vim</title>
        <description>&lt;p&gt;This is my Vim cheatsheet. For noobs only.&lt;/p&gt;

&lt;h1 id=&quot;vim-indentation&quot;&gt;Vim indentation&lt;/h1&gt;
&lt;p&gt;gg=G - reindent the entire file&lt;/p&gt;

&lt;h1 id=&quot;vim-search-and-replace&quot;&gt;Vim search and replace&lt;/h1&gt;
&lt;p&gt;:%s/foo/bar/g - search for foo and replace it with bar in the file.
:%s/foo/bar/gc - same as above but this will ask for confirmation before replace.
:%s/foo/bar/gci - case sensitive search.&lt;/p&gt;

&lt;h1 id=&quot;vim-search&quot;&gt;Vim search&lt;/h1&gt;
&lt;p&gt;* - search the next word before index
# - search previous word before index&lt;/p&gt;

&lt;h1 id=&quot;vim-using-tabs&quot;&gt;Vim using tabs&lt;/h1&gt;
&lt;p&gt;Open many files in new tabs
vim -p firtfile secondfile thridfile&lt;/p&gt;

&lt;p&gt;:tabnew filename - Create a new file in a new tab&lt;/p&gt;

&lt;p&gt;:tabe filepath - Open a file in a new tab&lt;/p&gt;

&lt;p&gt;:tabn - switches to the next tab.&lt;/p&gt;

&lt;p&gt;:tabp - switches to the previous tab.&lt;/p&gt;

&lt;p&gt;gt - toggles through all tabs, from left to right.&lt;/p&gt;

&lt;p&gt;gT - similar to gt but in opposite direction.&lt;/p&gt;

&lt;p&gt;:tabdo %s/foo/bar/g - run a command on all tabs. Eg.: Run command %s/foo/bar/g on all tabs.&lt;/p&gt;

&lt;p&gt;:help tab-page-intro - for more help.&lt;/p&gt;

&lt;h1 id=&quot;good-plugins&quot;&gt;Good Plugins:&lt;/h1&gt;
&lt;p&gt;To toogle the mouse press F12
https://github.com/nvie/vim-togglemouse&lt;/p&gt;

&lt;p&gt;Jedi Vim for python autocompletion
https://github.com/davidhalter/jedi-vim&lt;/p&gt;
</description>
        <pubDate>Tue, 31 May 2016 09:26:34 -0400</pubDate>
        <link>http://andrechang.github.io/vim.html</link>
        <guid isPermaLink="true">http://andrechang.github.io/vim.html</guid>
        
        <category>vim</category>
        
        
        <category>vim</category>
        
      </item>
    
      <item>
        <title>My First Video Post on Jekyll</title>
        <description>&lt;p&gt;Steve Austin: Astronaut. A man barely alive. Gentlemen… we can rebuild him. We have the technology. We have the capability to make the world’s first bionic man. Steve Austin will be that man. Better than he was before. Better. Stronger. Faster.&lt;/p&gt;

&lt;p&gt;My name is Rhoda Morgenstern. I was born in the Bronx, New York in December of 1941. I’ve always felt responsible for World War II. The first thing I remember liking that liked me back was food. I had a bad puberty; it lasted seventeen years. I’m a high school graduate. I went to art school. My entrance exam was on a book of matches. I decided to move out of the house when I was twenty-four. My mother still refers to this as the time I ran away from home. Eventually, I ran to Minneapolis, where it’s cold and I figured I’d keep better. Now I’m back in Manhattan. New York, this is your last chance!&lt;/p&gt;

&lt;p&gt;Dr. David Banner: physician; scientist. Searching for a way to tap into the hidden strengths that all humans have… then an accidental overdose of gamma radiation alters his body chemistry. And now when David Banner grows angry or outraged, a startling metamorphosis occurs. The creature is driven by rage and pursued by an investigative reporter. The creature is wanted for a murder he didn’t commit. David Banner is believed to be dead, and he must let the world think that he is dead, until he can find a way to control the raging spirit that dwells within him.&lt;/p&gt;

</description>
        <pubDate>Mon, 31 Aug 2015 09:26:34 -0400</pubDate>
        <link>http://andrechang.github.io/my-first-video-post.html</link>
        <guid isPermaLink="true">http://andrechang.github.io/my-first-video-post.html</guid>
        
        <category>mars</category>
        
        <category>videos</category>
        
        
        <category>blog</category>
        
        <category>development</category>
        
      </item>
    
      <item>
        <title>My First Normal Post on Jekyll</title>
        <description>&lt;p&gt;Steve Austin: Astronaut. A man barely alive. Gentlemen… we can rebuild him. We have the technology. We have the capability to make the world’s first bionic man. Steve Austin will be that man. Better than he was before. Better. Stronger. Faster.&lt;/p&gt;

&lt;p&gt;My name is Rhoda Morgenstern. I was born in the Bronx, New York in December of 1941. I’ve always felt responsible for World War II. The first thing I remember liking that liked me back was food. I had a bad puberty; it lasted seventeen years. I’m a high school graduate. I went to art school. My entrance exam was on a book of matches. I decided to move out of the house when I was twenty-four. My mother still refers to this as the time I ran away from home. Eventually, I ran to Minneapolis, where it’s cold and I figured I’d keep better. Now I’m back in Manhattan. New York, this is your last chance!&lt;/p&gt;

&lt;p&gt;Dr. David Banner: physician; scientist. Searching for a way to tap into the hidden strengths that all humans have… then an accidental overdose of gamma radiation alters his body chemistry. And now when David Banner grows angry or outraged, a startling metamorphosis occurs. The creature is driven by rage and pursued by an investigative reporter. The creature is wanted for a murder he didn’t commit. David Banner is believed to be dead, and he must let the world think that he is dead, until he can find a way to control the raging spirit that dwells within him.&lt;/p&gt;

</description>
        <pubDate>Sat, 15 Aug 2015 09:26:34 -0400</pubDate>
        <link>http://andrechang.github.io/my-first-normal-post.html</link>
        <guid isPermaLink="true">http://andrechang.github.io/my-first-normal-post.html</guid>
        
        <category>html</category>
        
        <category>css</category>
        
        <category>javascript</category>
        
        
        <category>blog</category>
        
        <category>development</category>
        
      </item>
    
  </channel>
</rss>
